---
title: "Flow beim Gehen (intraindividell)"
author: "Simon Bogutzky"
date: "25. Februar 2016"
output: html_document
---
  
```{r load-data, include=FALSE}

# Remove all variables
rm(list = ls(all = T))

# Set working directory
setwd("~/psychophysiopipeline/report")

# Load functions
source("./code-snippets/functions.r")

# Set paths
root.path <- "C:/Users/sbogutzky/Desktop/data (lokal)/2013/"

# Set variables
user <- "grueter-barbara"
activity <- "gehen"

# Collect data
data.1 <- data.frame()
    
# Load FSS features
fss.feature.path <- paste(root.path, "features", "/", activity, "/", user, "/", "fss-features.csv", sep = "")
fss.features <- read.csv(fss.feature.path)
rm(fss.feature.path)
    
# Load HRV features
source("code-snippets/load-hrv-features.R")
    
# Load jerk cost features
source("code-snippets/load-jc-features.R")
    
# Load synchronization features
source("code-snippets/load-cls-features.R") 

# Set factors
subjects <- factor(fss.features$first.name, levels = c("Barbara"), labels = c("Female"))
measurements <- factor(fss.features$measurement, levels = c(1, 2, 3, 4), labels = c("15'", "30'", "45'", "60'"))
  
# Create data frame
data.1 <- rbind(data.1, data.frame(subject = subjects, session.start = factor(fss.features$session.start), measurement = measurements, fss.features[, c(1:8)], hrv.features[, c(3, 5)], cls.features[, 1:2], jc.features[, 1:2]))
rownames(data.1) <- seq(length = nrow(data.1))

attach(data.1)

rm(user, activity, fss.features, hrv.features, cls.features, jc.features, subjects, measurements)
```

```{r check-day-effect-on-flow}
par(mfrow = c(2, 1))
hist(flow)
print(shapiro.test(flow))

boxplot(flow ~ session.start)

aov.1 <- aov(flow ~ session.start, data = data.1)
summary(aov.1)

levene(flow, session.start)
summary.lm(aov.1)

pairwise.t.test(flow, session.start, p.adj = "holm")
rm(aov.1)
```

```{r check-day-effect-on-fluency}
par(mfrow = c(2, 1))
hist(fluency)
print(shapiro.test(fluency))

boxplot(fluency ~ session.start)

aov.1 <- aov(fluency ~ session.start, data = data.1)
summary(aov.1)

levene(fluency, session.start)
summary.lm(aov.1)

pairwise.t.test(fluency, session.start, p.adj = "holm")
rm(aov.1)
```

```{r check-day-effect-on-absorption}
par(mfrow = c(2, 1))
hist(absorption)
print(shapiro.test(absorption))

boxplot(absorption ~ session.start)

aov.1 <- aov(absorption ~ session.start, data = data.1)
summary(aov.1)

levene(absorption, session.start)
summary.lm(aov.1)

pairwise.t.test(absorption, session.start, p.adj = "holm")
rm(aov.1)
```

```{r check-time-effect-on-flow}
par(mfrow = c(2, 1))
hist(flow)
print(shapiro.test(flow))

boxplot(flow ~ measurement)

aov.1 <- aov(flow ~ measurement, data = data.1)
summary(aov.1)

levene(flow, measurement)
summary.lm(aov.1)

pairwise.t.test(flow, measurement, p.adj = "holm")
rm(aov.1)
```

```{r check-time-effect-on-fluency}
par(mfrow = c(2, 1))
hist(fluency)
print(shapiro.test(fluency))

boxplot(fluency ~ measurement)

aov.1 <- aov(fluency ~ measurement, data = data.1)
summary(aov.1)

levene(fluency, measurement)
summary.lm(aov.1)

pairwise.t.test(fluency, measurement, p.adj = "holm")
rm(aov.1)
```

```{r check-time-effect-on-absorption}
par(mfrow = c(2, 1))
hist(absorption)
print(shapiro.test(absorption))

boxplot(absorption ~ measurement)

aov.1 <- aov(absorption ~ measurement, data = data.1)
summary(aov.1)

levene(absorption, measurement)
summary.lm(aov.1)

pairwise.t.test(absorption, measurement, p.adj = "holm")
rm(aov.1)
```

```{r plot}
par(mfrow = c(3, 2))

data.2 <- data.1[-c(16),]

plot(data.2$mean.hr, data.2$flow, xlab = "Mean HR", ylab = "Flow", pch = 21, bg = "tomato")
PlotModels(data.2$mean.hr, data.2$flow)

plot(data.2$mean.hr, data.2$absorption, xlab = "Mean HR", ylab = "Absorption", pch = 21, bg = "tomato")
PlotModels(data.2$mean.hr, data.2$absorption)

plot(data.2$rmssd, data.2$flow, xlab = "RMSSD", ylab = "Flow", pch = 21, bg = "tomato")
PlotModels(data.2$rmssd, data.2$flow)

plot(data.2$rmssd, data.2$absorption, xlab = "RMSSD", ylab = "Absorption", pch = 21, bg = "tomato")
PlotModels(data.2$rmssd, data.2$absorption)

plot(data.2$mean.nsei, data.2$flow, xlab = "Mean Normalized Shannon Entropy Index", ylab = "Flow", pch = 21, bg = "darkolivegreen1") 
PlotModels(data.2$mean.nsei, data.2$flow)

plot(data.2$mean.nsei, data.2$absorption, xlab = "Mean Normalized Shannon Entropy Index", ylab = "Absorption", pch = 21, bg = "darkolivegreen1") 
PlotModels(data.2$mean.nsei, data.2$absorption)

par(mfrow = c(3, 2))

plot(data.2$mean.nsei, data.2$flow, xlab = "Mean Normalized Shannon Entropy Index", ylab = "Flow", pch = 21, bg = "darkolivegreen1") 
PlotModels(data.2$mean.nsei, data.2$flow)

plot(data.2$mean.nsei, data.2$fluency, xlab = "Mean Normalized Shannon Entropy Index", ylab = "Fluency", pch = 21, bg = "darkolivegreen1") 
PlotModels(data.2$mean.nsei, data.2$fluency)

plot(data.2$mean.cycle.interval, data.2$flow, xlab = "Mean Cycle Interval", ylab = "Flow", pch = 23, bg = "deepskyblue") 
PlotModels(data.2$mean.cycle.interval, data.2$flow)

plot(data.2$mean.cycle.interval, data.2$fluency, xlab = "Mean Cycle Interval", ylab = "Fluency", pch = 23, bg = "deepskyblue") 
PlotModels(data.2$mean.cycle.interval, data.2$fluency)

plot(data.2$mean.jerk.cost, data.2$flow, xlab = "Mean Jerk Cost", ylab = "Flow", pch = 23, bg = "deepskyblue") 
PlotModels(data.2$mean.jerk.cost, data.2$flow)

plot(data.2$mean.jerk.cost, data.2$fluency, xlab = "Mean Jerk Cost", ylab = "Fluency", pch = 23, bg = "deepskyblue") 
PlotModels(data.2$mean.jerk.cost, data.2$fluency)
```

```{r multilevel-model-for-flow}
require(lme4) 

random.intercept.model <- lmer(absorption ~ (1 | session.start), data = data.2, REML = FALSE)
null.model <- lm(absorption ~ 1, data = data.2)

random.intercept.model.log.lik <- as.numeric(logLik(random.intercept.model))
null.model.log.lik <- as.numeric(logLik(null.model))
lr <- 2 * (random.intercept.model.log.lik - null.model.log.lik)

print(paste("LR:", lr, "chi-squared distribution on 1 d.f.:", qchisq(.95, df = 1)))

mean.hr.2 <- mean.hr^2
random.intercept.model <- lmer(absorption ~ mean.hr + mean.hr.2 + (1 | measurement), data = data.2, REML = FALSE)
summary(random.intercept.model)

linear.model <- lm(absorption ~ mean.hr + mean.hr.2, data = data.2)
summary(linear.model)

random.intercept.model.log.lik <- as.numeric(logLik(random.intercept.model))
linear.model.log.lik <- as.numeric(logLik(linear.model))
lr <- 2 * (random.intercept.model.log.lik - linear.model.log.lik)

print(paste("LR:", lr, "chi-squared distribution on 1 d.f.:", qchisq(.95, df = 1)))

pred.flow <- fitted(random.intercept.model)

plot(mean.hr, pred.flow, xlab = "Mean HR", ylab = "Pred. Flow", pch = 21, bg = "tomato")


random.intercept.model <- lmer(absorption ~ mean.nsei + (1 | measurement), data = data.2, REML = FALSE)
summary(random.intercept.model)

linear.model <- lm(absorption ~ mean.nsei, data = data.2)
summary(linear.model)

random.intercept.model.log.lik <- as.numeric(logLik(random.intercept.model))
linear.model.log.lik <- as.numeric(logLik(linear.model))
lr <- 2 * (random.intercept.model.log.lik - linear.model.log.lik)

print(paste("LR:", lr, "chi-squared distribution on 1 d.f.:", qchisq(.95, df = 1)))

pred.flow <- fitted(random.intercept.model)

plot(mean.nsei, pred.flow, xlab = "Mean Normalized Shannon Entropy Index", ylab = "Pred. Flow", pch = 21, bg = "darkolivegreen1")
```



